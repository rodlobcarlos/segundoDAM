package simulacroMongoDB_repository;

import java.util.ArrayList;
import java.util.List;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.bson.Document;

import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;

import simulacroMongoDB_model.Coordenadas;
import simulacroMongoDB_model.Habitacion;
import simulacroMongoDB_model.Hotel;
import simulacroMongoDB_model.Tipo;
import simulacroMongoDB_model.Ubicacion;

public class Hotel_repository {

	private List<Hotel> hoteles;
	private static final String NOMBRE_COLECCION = "hoteles";
	private final MongoCollection<Document> coleccion;
	private static final Logger logger = LogManager.getLogger(Hotel_repository.class);
	
	public List<Hotel> getHoteles() {
		return hoteles;
	}
	public void setHoteles(List<Hotel> hoteles) {
		this.hoteles = hoteles;
	}
	public static String getNombreColeccion() {
		return NOMBRE_COLECCION;
	}
	public MongoCollection<Document> getColeccion() {
		return coleccion;
	}
	public static Logger getLogger() {
		return logger;
	}
	public Hotel_repository(MongoDatabase db) {
		super();
		this.coleccion = db.getCollection(NOMBRE_COLECCION);
		this.hoteles = this.read();
	}
	
	private Hotel fromDocumentoHotel2Java(Document doc) {
		Hotel h = new Hotel();
		h.setIdHotel(doc.getString("idHotel"));
		h.setNombre(doc.getString("Nombre"));
		h.setEstrellas(doc.getInteger("estrellas", 0));
		h.setAdmiteMascotas(doc.getBoolean("admiteMascotas", false));
		h.setFechaApertura(doc.getString("fechaApertura"));
		
		Document docUbicacion = (Document) doc.get("ubicacion");
		Ubicacion u = new Ubicacion();
		u.setCalle(docUbicacion.getString("calle"));
		u.setNumero(docUbicacion.getInteger("numero", 0));
		u.setCodigoPostal(docUbicacion.getString("codigoPostal"));
		h.setUbicacion(u);
		
		Document docCoordenadas = (Document) doc.get("coordenadas");
		Coordenadas c = new Coordenadas();
		c.setLat(docCoordenadas.getDouble("lat"));
		c.setLon(docCoordenadas.getLong("lon"));
		u.setCoordenadas(c);
		
		
		List<Document> listaDocHabitaciones = doc.getList("habitacion", Document.class);
		List<Habitacion> listaHabitaciones = new ArrayList<Habitacion>();
		for(Document document: listaDocHabitaciones) {
			Habitacion a = new Habitacion();
			a.setTipo(Tipo.valueOf(document.getString("tipo")));
			a.setPrecio(document.getDouble("precio"));
			a.setCapacidad(document.getInteger("capacidad", 0));
			a.setDiponible(document.getBoolean("disponible", false));
			listaHabitaciones.add(a);
		}
		h.setHabitaciones(listaHabitaciones);
		return h;
	}
	
	private Document fromHotelDocumentoJava(Hotel h) {
		Document docHotel = new Document("idHotel", h.getIdHotel());
		return doc;
	}
}
